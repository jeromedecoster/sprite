/*! sprite v0.1.0 | github.com/jeromedecoster/sprite */
function Sprite(t){if(!(this instanceof Sprite))return new Sprite(t);this.check(t,"src","columns","rows","el"),this.src=t.src,this.columns=t.columns,this.rows=t.rows,this.delay=t.delay||60,this.waitStart=t.waitStart||0,this.waitEnd=t.waitEnd||0,/^(loop|yoyo)$/.test(t.motion)&&(this.motion=t.motion),this.canvas="canvas"==t.el.nodeName.toLowerCase();var i=this;this.loaded=!1,this.img=new Image,this.img.src=t.src,this.img.onload=function(){i.onload(this,t)}}Sprite.prototype.play=function(){return this.loaded?void(1!=this.direction&&(void 0==this.interval||"yoyo"!=this.motion)&&(this.clear(),this.direction=1,this.animate())):this.cb=[this.play]},Sprite.prototype.rewind=function(){return this.loaded?void(-1!=this.direction&&void 0==this.motion&&0!=this.index&&(this.clear(),this.direction=-1,this.animate())):this.cb=[this.rewind]},Sprite.prototype.stop=function(t,i){return this.loaded?void(i!==!0||void 0==this.interval&&void 0==this.timeout?(this.clear(),void 0!=t&&(this.index=this.clamp(t),this.draw())):this.finish=this.clamp(t)):this.cb=[this.stop,t,i]},Sprite.prototype.check=function(t){for(var i=1,h=arguments.length;h>i;i++)if(void 0==t[arguments[i]])throw new Error("Sprite param `"+arguments[i]+"` required")},Sprite.prototype.onload=function(t,i){var h=i.rows*i.columns;this.max=i.frames?Math.max(0,Math.min(h-1,i.frames-1)):h-1,this.width=t.width/i.columns,this.height=t.height/i.rows,i.el.style.width=this.width+"px",i.el.style.height=this.height+"px",this.canvas?(i.el.width=this.width,i.el.height=this.height,this.el=i.el.getContext("2d")):(this.el=i.el,this.el.style.backgroundImage="url("+this.src+")"),this.index=this.clamp(i.index||0),this.draw(),this.loaded=!0,this.cb&&(this.cb[0].apply(this,this.cb.splice(1)),this.cb=void 0)},Sprite.prototype.draw=function(){var t=Math.floor(this.index/this.columns),i=this.index-t*this.columns;this.canvas?(this.el.clearRect(0,0,this.width,this.height),this.el.drawImage(this.img,this.width*i,this.height*t,this.width,this.height,0,0,this.width,this.height)):this.el.style.backgroundPosition=-this.width*i+"px "+-this.height*t+"px"},Sprite.prototype.clear=function(t){clearInterval(this.interval),clearTimeout(this.timeout),this.interval=void 0,this.timeout=void 0,t!==!0&&(this.direction=void 0)},Sprite.prototype.animate=function(){var t=this;this.interval=setInterval(function(){t.update()},this.delay)},Sprite.prototype.update=function(){var t=this;this.direction>0?(this.index+=1,"yoyo"==this.motion?this.index>this.max?(this.direction=-1,this.index=this.max-1):this.index==this.max&&(this.direction=-1,this.waitEnd>0&&(this.clear(!0),this.timeout=setTimeout(function(){t.animate()},this.waitEnd))):"loop"==this.motion?this.index>this.max?this.index=0:this.index==this.max&&this.waitEnd>0&&(this.clear(!0),setTimeout(function(){t.animate()},this.waitEnd)):this.index>this.max?this.index=0:this.index==this.max&&this.clear(),this.draw()):this.direction<0&&(this.index-=1,"yoyo"==this.motion?0==this.index&&(this.direction=1,this.waitStart>0&&(this.clear(!0),this.timeout=setTimeout(function(){t.animate()},this.waitStart))):void 0==this.motion&&0==this.index&&this.clear(),this.draw()),void 0!=this.finish&&this.finish==this.index&&(this.finish=void 0,this.clear())},Sprite.prototype.clamp=function(t){return Math.max(0,Math.min(this.max,t))};
